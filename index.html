<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Calendrier Gamer</title>
<style>
:root{
  --bg:#0b0f17;--panel:#131a2a;--accent:#7c3aed;--accent2:#06b6d4;
  --text:#e6eef8;--muted:#98a8bf;--danger:#ef4444;--today:#10b981;
}
body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:0}
h2{margin:0 0 6px}
.app{max-width:1200px;margin:12px auto;padding:12px;display:grid;grid-template-columns:300px 1fr;gap:12px}
.panel,.calendar{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 0 12px rgba(124,58,237,0.2)}
button,select,input[type='text'],input[type='datetime-local'],input[type='color'],select.filter{
  background:#111827;color:var(--text);border:1px solid #1f2937;border-radius:6px;padding:6px;transition:0.2s
}
button:hover{background:var(--accent);color:white;cursor:pointer}
.calendar .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
.weekday{padding:6px;text-align:center;color:var(--muted);font-size:12px;border-bottom:1px solid #1f2937}
.day{min-height:90px;border:1px solid #1f2937;border-radius:6px;padding:4px;position:relative;transition:0.2s}
.day .date{position:absolute;top:4px;right:6px;font-size:11px;color:var(--muted)}
.day.other-month{opacity:0.3}
.day.today{border:2px solid var(--today)}
.day.expired{opacity:0.4}
.event{display:block;margin-top:18px;padding:3px 6px;border-radius:6px;font-size:12px;color:#000;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:pointer}
.event.done{text-decoration:line-through;opacity:0.6}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:100}
.modal{background:var(--panel);padding:14px;border-radius:12px;width:420px;max-width:95%}
li.done{text-decoration:line-through;opacity:0.6}
.actions{margin-top:10px;display:flex;gap:6px;flex-wrap:wrap}
.progress-bar{background:#111827;border-radius:6px;height:8px;overflow:hidden;margin-top:6px}
.progress-fill{height:100%;background:var(--accent)}
</style>
</head>
<body>
<div class="app">
  <div class="panel">
    <h2>Options</h2>
    <button id="addEventBtn">‚ûï Ajouter</button>
    <button id="todayBtn">üìÖ Aujourd‚Äôhui</button>
    <div style="margin-top:10px;">
      <input type="text" id="searchEvent" placeholder="üîç Rechercher..." style="width:100%;"/>
    </div>
    <div style="margin-top:10px;">
      <select id="filterColor" class="filter">
        <option value="">Filtrer par couleur</option>
      </select>
      <select id="filterRepeat" class="filter">
        <option value="">Filtrer par r√©p√©tition</option>
        <option value="none">Aucun</option>
        <option value="daily">Quotidien</option>
        <option value="weekly">Hebdomadaire</option>
        <option value="monthly">Mensuel</option>
      </select>
      <select id="filterDone" class="filter">
        <option value="">Filtrer par statut</option>
        <option value="done">Termin√©s</option>
        <option value="pending">En cours</option>
      </select>
    </div>
    <div class="actions">
      <button id="exportBtn">‚¨áÔ∏è Export JSON</button>
      <button id="importBtn">‚¨ÜÔ∏è Import JSON</button>
      <input type="file" id="importFile" style="display:none" />
      <button id="clearAll">üóëÔ∏è Tout effacer</button>
    </div>
    <h3 style="margin-top:12px">√âv√©nements du jour</h3>
    <ul id="dayEventsList" style="list-style:none;padding:0;font-size:13px;color:var(--muted)"></ul>
    <p id="eventCount" style="margin-top:10px;font-size:13px;color:var(--muted)"></p>
    <div class="progress-bar"><div class="progress-fill" id="monthProgress"></div></div>
    <h3 style="margin-top:12px">Prochains √©v√©nements</h3>
    <ul id="upcomingEvents" style="list-style:none;padding:0;font-size:13px;color:var(--muted)"></ul>
  </div>
  <div class="calendar">
    <div class="month-header">
      <button id="prevMonth">‚óÄ</button>
      <h2 id="monthYear"></h2>
      <button id="nextMonth">‚ñ∂</button>
    </div>
    <div class="grid" id="calendarGrid"></div>
  </div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3 id="modalTitle">Nouvel √©v√©nement</h3>
    <label>Titre</label>
    <input type="text" id="eventTitle">
    <label>Date & heure</label>
    <input type="datetime-local" id="eventDate">
    <label>Couleur</label>
    <input type="color" id="eventColor" value="#7c3aed">
    <label>R√©p√©ter</label>
    <select id="eventRepeat">
      <option value="none">Aucun</option>
      <option value="daily">Quotidien</option>
      <option value="weekly">Hebdomadaire</option>
      <option value="monthly">Mensuel</option>
    </select>
    <div style="margin-top:10px;display:flex;gap:6px">
      <button id="saveEvent">üíæ Sauver</button>
      <button id="cancelEvent">‚ùå Annuler</button>
    </div>
  </div>
</div>

<script>
const monthYear=document.getElementById('monthYear');
const calendarGrid=document.getElementById('calendarGrid');
const prevMonth=document.getElementById('prevMonth');
const nextMonth=document.getElementById('nextMonth');
const todayBtn=document.getElementById('todayBtn');
const addEventBtn=document.getElementById('addEventBtn');
const modalBackdrop=document.getElementById('modalBackdrop');
const saveEvent=document.getElementById('saveEvent');
const cancelEvent=document.getElementById('cancelEvent');
const eventTitle=document.getElementById('eventTitle');
const eventDate=document.getElementById('eventDate');
const eventColor=document.getElementById('eventColor');
const eventRepeat=document.getElementById('eventRepeat');
const dayEventsList=document.getElementById('dayEventsList');
const eventCount=document.getElementById('eventCount');
const clearAll=document.getElementById('clearAll');
const exportBtn=document.getElementById('exportBtn');
const importBtn=document.getElementById('importBtn');
const importFile=document.getElementById('importFile');
const searchEvent=document.getElementById('searchEvent');
const filterColor=document.getElementById('filterColor');
const filterRepeat=document.getElementById('filterRepeat');
const filterDone=document.getElementById('filterDone');
const monthProgress=document.getElementById('monthProgress');
const upcomingEvents=document.getElementById('upcomingEvents');

let currentDate=new Date();
let events=JSON.parse(localStorage.getItem('gamerEvents')||'[]');
let editIndex=null;

// ==== Fonctions ====
function renderCalendar(){
  const year=currentDate.getFullYear();
  const month=currentDate.getMonth();
  const firstDay=new Date(year,month,1);
  const lastDay=new Date(year,month+1,0);
  monthYear.textContent=currentDate.toLocaleString('fr-FR',{month:'long',year:'numeric'});

  calendarGrid.innerHTML='';
  const weekdays=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];
  weekdays.forEach(d=>{
    const wd=document.createElement('div'); wd.className="weekday"; wd.textContent=d;
    calendarGrid.appendChild(wd);
  });

  let startDay=(firstDay.getDay()+6)%7;
  for(let i=0;i<startDay;i++) calendarGrid.appendChild(document.createElement('div'));

  for(let d=1;d<=lastDay.getDate();d++){
    const div=document.createElement('div'); div.className='day';
    const span=document.createElement('span'); span.className='date'; span.textContent=d; div.appendChild(span);

    const dayEvents=events.filter(e=>{
      const eDate=new Date(e.date);
      return eDate.getDate()===d && eDate.getMonth()===month && eDate.getFullYear()===year;
    }).sort((a,b)=>new Date(a.date)-new Date(b.date));

    dayEvents.forEach(e=>{
      const ev=document.createElement('div'); ev.className='event'; if(e.done) ev.classList.add('done');
      if(new Date(e.date)<new Date()) div.classList.add('expired');
      ev.style.background=e.color||"#7c3aed"; ev.textContent=e.title;
      div.appendChild(ev);
    });

    const today=new Date();
    if(d===today.getDate() && month===today.getMonth() && year===today.getFullYear()) div.classList.add('today');

    div.onclick=()=>showDayEvents(new Date(year,month,d));
    calendarGrid.appendChild(div);
  }

  updateCount();
  showDayEvents(new Date());
  updateMonthProgress();
  updateUpcomingEvents();
  populateColorFilter();
}

function showDayEvents(date){
  let dayEvents=events.filter(e=>{
    const eDate=new Date(e.date);
    return eDate.getDate()===date.getDate() && eDate.getMonth()===date.getMonth() && eDate.getFullYear()===date.getFullYear();
  }).sort((a,b)=>new Date(a.date)-new Date(b.date));

  const filterText=searchEvent.value.toLowerCase();
  if(filterText) dayEvents=dayEvents.filter(e=>e.title.toLowerCase().includes(filterText));

  const colorFilter=filterColor.value;
  if(colorFilter) dayEvents=dayEvents.filter(e=>e.color===colorFilter);

  const repeatFilter=filterRepeat.value;
  if(repeatFilter) dayEvents=dayEvents.filter(e=>e.repeat===repeatFilter);

  const doneFilter=filterDone.value;
  if(doneFilter==='done') dayEvents=dayEvents.filter(e=>e.done);
  else if(doneFilter==='pending') dayEvents=dayEvents.filter(e=>!e.done);

  dayEventsList.innerHTML='';
  if(dayEvents.length===0){dayEventsList.innerHTML='<li>Aucun √©v√©nement</li>'}
  else{
    dayEvents.forEach((e,i)=>{
      const li=document.createElement('li');
      li.textContent=`${new Date(e.date).toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})} - ${e.title}`;
      if(e.done) li.classList.add("done");

      const btnDone=document.createElement("button"); btnDone.textContent="‚úîÔ∏è";
      btnDone.onclick=()=>{e.done=!e.done;saveEvents();renderCalendar()};

      const btnDel=document.createElement("button"); btnDel.textContent="üóëÔ∏è";
      btnDel.onclick=()=>{events=events.filter(ev=>ev!==e);saveEvents();renderCalendar()};

      const btnDup=document.createElement("button"); btnDup.textContent="üìÑ";
      btnDup.onclick=()=>{events.push({...e,date:new Date().toISOString()}); saveEvents(); renderCalendar()};

      li.append(" ",btnDone," ",btnDel," ",btnDup);
      dayEventsList.appendChild(li);
    })
  }
}

function openModal(e=null,i=null){
  modalBackdrop.style.display='flex';
  if(e){eventTitle.value=e.title;eventDate.value=e.date;eventColor.value=e.color||"#7c3aed"; eventRepeat.value=e.repeat||"none"; editIndex=i}
  else{eventTitle.value='';eventDate.value='';eventColor.value="#7c3aed"; eventRepeat.value="none"; editIndex=null}
}
function closeModal(){modalBackdrop.style.display='none'}

function saveEvents(){localStorage.setItem('gamerEvents',JSON.stringify(events))}

// ==== Actions ====
saveEvent.onclick=()=>{
  if(!eventTitle.value||!eventDate.value){alert('Remplis tous les champs'); return}
  const ev={title:eventTitle.value,date:eventDate.value,color:eventColor.value,done:false,repeat:eventRepeat.value};
  if(editIndex!==null) events[editIndex]=ev; else events.push(ev);
  saveEvents(); closeModal(); renderCalendar();
};
cancelEvent.onclick=closeModal;
addEventBtn.onclick=()=>openModal();
prevMonth.onclick=()=>{currentDate.setMonth(currentDate.getMonth()-1);renderCalendar()};
nextMonth.onclick=()=>{currentDate.setMonth(currentDate.getMonth()+1);renderCalendar()};
todayBtn.onclick=()=>{currentDate=new Date();renderCalendar()};
clearAll.onclick=()=>{if(confirm("Tout effacer ?")){events=[];saveEvents();renderCalendar()}};
exportBtn.onclick=()=>{
  const data=JSON.stringify(events);
  const blob=new Blob([data],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="calendrier_gamer.json"; a.click();
  URL.revokeObjectURL(url);
};
importBtn.onclick=()=>importFile.click();
importFile.onchange=(e)=>{
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{events=JSON.parse(ev.target.result);saveEvents();renderCalendar()};
  reader.readAsText(file);
};
searchEvent.oninput=()=>renderCalendar();
filterColor.onchange=renderCalendar;
filterRepeat.onchange=renderCalendar;
filterDone.onchange=renderCalendar;

function updateCount(){
  const done=events.filter(e=>e.done).length;
  eventCount.textContent=`Total : ${events.length} | Termin√©s : ${done}`;
}

function updateMonthProgress(){
  const today=new Date();
  const daysInMonth=new Date(today.getFullYear(),today.getMonth()+1,0).getDate();
  const percent=(today.getDate()/daysInMonth)*100;
  monthProgress.style.width=percent+"%";
}

function populateColorFilter(){
  const colors=[...new Set(events.map(e=>e.color))];
  filterColor.innerHTML='<option value="">Filtrer par couleur</option>';
  colors.forEach(c=>filterColor.innerHTML+=`<option value="${c}">${c}</option>`);
}

function updateUpcomingEvents(){
  const now=new Date();
  const upcoming=events.filter(e=>new Date(e.date)>now && !e.done).sort((a,b)=>new Date(a.date)-new Date(b.date)).slice(0,5);
  upcomingEvents.innerHTML='';
  if(upcoming.length===0) upcomingEvents.innerHTML='<li>Aucun √©v√©nement √† venir</li>';
  else upcoming.forEach(e=>{
    const li=document.createElement('li');
    li.textContent=`${new Date(e.date).toLocaleString('fr-FR',{hour:'2-digit',minute:'2-digit'})} - ${e.title}`;
    upcomingEvents.appendChild(li);
  });
}

// ==== Notifications ====
if("Notification" in window && Notification.permission!=="granted"){Notification.requestPermission();}

function checkNotifications(){
  if(!("Notification" in window) || Notification.permission!=="granted") return;
  const now=new Date();
  events.forEach(e=>{
    if(e.notified) return;
    const eventTime=new Date(e.date).getTime();
    const diff=(eventTime-now.getTime())/60000;
    if(diff<=10 && diff>0 && !e.done){
      new Notification("‚è∞ √âv√©nement bient√¥t !",{body:e.title+" dans "+Math.round(diff)+" minutes"});
      e.notified=true;
      saveEvents();
    }
  });
}
setInterval(checkNotifications,60000);

renderCalendar();
</script>
</body>
</html>